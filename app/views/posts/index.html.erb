<% content_for :title, page_title("Home") %>

<div class="posts-page">
  <div class="posts-hero">
    <div>
      <h1 class="posts-title">Latest posts</h1>
      <p class="posts-subtitle">Fresh notes, essays, and experiments.</p>
    </div>
    <% if authenticated? %>
      <%= link_to "New post", new_post_path, class: "btn" %>
    <% end %>
  </div>

  <div class="search-bar">
    <%= form_with url: posts_path, method: :get, local: true do %>
      <%= text_field_tag :query, params[:query], placeholder: "Search posts...", class: "search-input" %>
      <%= submit_tag "Search", class: "btn" %>
    <% end %>
  </div>

  <% if notice.present? %>
    <p class="notice"><%= notice %></p>
  <% end %>

  <% if @search_query.present? %>
    <p class="search-summary"><%= @search_results %> results for "<%= @search_query %>"</p>
    <% if @posts.any? %>
      <div id="posts" class="posts-list">
        <% @posts.each do |post| %>
          <div class="card">
            <div class="post-content">
              <%= render post %>
              <%= post.preview %>
              <%= link_to "Read more", post_path(post), class: "read-more" %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="search-empty">No results found for "<%= @search_query %>".</p>
    <% end %>
  <% else %>
    <div id="posts" class="posts-list">
      <% @posts.each do |post| %>
        <div class="card">
          <div class="post-content">
            <%= render post %>
            <%= post.preview %>
            <%= link_to "Read more", post_path(post), class: "read-more" %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <div class="pagination">
    <%= paginate @posts %>
  </div>
</div>
